pluginManagement {
    def flutterSdkPath = {
        def properties = new Properties()
        // Make sure local.properties exists and has flutter.sdk
        def localPropertiesFile = file("local.properties")
        if (!localPropertiesFile.exists()) {
            throw new GradleException("local.properties not found. Make sure you have run 'flutter doctor'.")
        }
        localPropertiesFile.withInputStream { properties.load(it) }
        def flutterSdkPath = properties.getProperty("flutter.sdk")
        assert flutterSdkPath != null, "flutter.sdk not set in local.properties"
        return flutterSdkPath
    }
    settings.ext.flutterSdkPath = flutterSdkPath()

    includeBuild("${settings.ext.flutterSdkPath}/packages/flutter_tools/gradle")

    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }

    // Define plugin versions used across the project
    plugins {
        // Flutter plugin version (usually managed by Flutter SDK)
        id "dev.flutter.flutter-gradle-plugin" version "1.0.0" apply false

        // --- FIX: Add Kotlin plugin version definition ---
        id 'org.jetbrains.kotlin.android' version '1.9.24' apply false // Added compatible Kotlin version

        // --- FIX: Update AGP version definition ---
        // Note: Keep com.android.application definition below outside pluginManagement
        // if that's the required structure, but define its version *here*.
        // However, the standard is often to define it here like Kotlin.
        // Let's try defining it here first as it's cleaner.
        // If you get errors about it being applied, move the definition back down
        // but KEEP the version '8.5.0'.
        id 'com.android.application' version '8.5.0' apply false // Updated AGP version
    }
}

// Apply plugins to the project
plugins {
    id "dev.flutter.flutter-plugin-loader" version "1.0.0"
    // --- FIX: Remove version from here, it's defined above ---
    id "com.android.application" apply false // Version is now managed in pluginManagement
    // Apply Kotlin plugin if needed at this level (often not necessary here)
    // id 'org.jetbrains.kotlin.android' apply false
}

include ":app"


